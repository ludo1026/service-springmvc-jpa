#set( $tools = $loader.newInstance("Tools") )
##--------------------------------------------------------------------------------------------------------
## Link fields = fields not in Primary Key and used as FK in selected Links    
#set( $fieldsLink = $entity.getAttributesByCriteria( $const.NOT_KEY, $const.IN_SELECTED_LINKS ) )
##--------------------------------------------------------------------------------------------------------
/*
 * Created on $today.date ( Time $today.time )
 * Generated by $generator.name ( version $generator.version )
 */
package ${target.javaPackageFromFolder(${SRC})};

import org.modelmapper.ModelMapper;
import org.modelmapper.PropertyMap;
import org.modelmapper.convention.MatchingStrategies;
import org.springframework.stereotype.Component;
import org.telosys.bean.${entity.name};
import org.telosys.bean.jpa.${entity.name}Entity;

/**
 * Mapping between entity beans and display beans.
 */
@Component
public class ${entity.name}ServiceMapper extends AbstractServiceMapper {

	/**
	 * ModelMapper : bean to bean mapping library.
	 */
	private ModelMapper modelMapper;
	
	/**
	 * Constructor.
	 */
	public ${entity.name}ServiceMapper() {
		
		// ModelMapper
		modelMapper = new ModelMapper();
		modelMapper.getConfiguration().setMatchingStrategy(MatchingStrategies.STRICT);
		
		// Mapping : display bean -> entity bean
		modelMapper.addMappings(new PropertyMap<${entity.name}, ${entity.name}Entity>() {

			@Override
			protected void configure() {
#foreach( $link in $entity.selectedLinks )
#set( $fieldsMappingForLink = $tools.fieldsMappingForLink( $entity, $model.getEntityByClassName($link.targetEntityType), $link, $fieldsLink ) )
#foreach( $fieldMappingForLink in $fieldsMappingForLink.entrySet() )
				map().${link.getter}().${fieldMappingForLink.value.setter}(source.${fieldMappingForLink.key.getter}());
#end
#end
			}
			
		});
		
		// Mapping : entity bean -> display bean
		modelMapper.addMappings(new PropertyMap<${entity.name}Entity, ${entity.name}>() {

			@Override
			protected void configure() {
#foreach( $link in $entity.selectedLinks )
#set( $fieldsMappingForLink = $tools.fieldsMappingForLink( $entity, $model.getEntityByClassName($link.targetEntityType), $link, $fieldsLink ) )
#foreach( $fieldMappingForLink in $fieldsMappingForLink.entrySet() )
				map().${fieldMappingForLink.key.setter}(source.${link.getter}().${fieldMappingForLink.value.getter}());
#end
#end
			}
			
		});
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	protected ModelMapper getModelMapper() {
		return modelMapper;
	}

}
