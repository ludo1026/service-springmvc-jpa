#set( $tools = $loader.newInstance("Tools") )
##--------------------------------------------------------------------------------------------------------
## Link fields = fields not in Primary Key and used as FK in selected Links    
#set( $fieldsLink = $entity.getAttributesByCriteria( $const.NOT_KEY, $const.IN_SELECTED_LINKS ) )
##--------------------------------------------------------------------------------------------------------
/*
 * Created on $today.date ( Time $today.time )
 * Generated by $generator.name ( version $generator.version )
 */
package ${target.javaPackageFromFolder(${SRC})};

import org.modelmapper.ModelMapper;
import org.modelmapper.PropertyMap;
import org.modelmapper.convention.MatchingStrategies;
import org.springframework.stereotype.Component;
import ${ENTITY_PKG}.${entity.name};
#foreach( $link in $entity.selectedLinks )
import ${ENTITY_PKG}.${link.targetEntitySimpleType};
#end
import ${ENTITY_PKG}.jpa.${entity.name}Entity;
#foreach( $link in $entity.selectedLinks )
import ${ENTITY_PKG}.jpa.${link.targetEntitySimpleType}Entity;
#end

/**
 * Mapping between entity beans and display beans.
 */
@Component
public class ${entity.name}ServiceMapper extends AbstractServiceMapper {

	/**
	 * ModelMapper : bean to bean mapping library.
	 */
	private ModelMapper modelMapper;
	
	/**
	 * Constructor.
	 */
	public ${entity.name}ServiceMapper() {
		modelMapper = new ModelMapper();
		modelMapper.getConfiguration().setMatchingStrategy(MatchingStrategies.STRICT);
	}

	public ${entity.name} map${entity.name}EntityTo${entity.name}(${entity.name}Entity ${fn.uncapitalize(${entity.name})}Entity) {
		if(${fn.uncapitalize(${entity.name})}Entity == null) {
			return null;
		}
		${entity.name} ${fn.uncapitalize(${entity.name})} = map(${fn.uncapitalize(${entity.name})}Entity, ${entity.name}.class);
#foreach( $link in $entity.selectedLinks )
#set( $fieldsMappingForLink = $tools.fieldsMappingForLink( $entity, $model.getEntityByClassName($link.targetEntitySimpleType), $link, $fieldsLink ) )
#foreach( $fieldMappingForLink in $fieldsMappingForLink.entrySet() )

		if(${fn.uncapitalize(${entity.name})}Entity.${link.getter}() != null) {
			${fn.uncapitalize(${entity.name})}.${fieldMappingForLink.key.setter}(${fn.uncapitalize(${entity.name})}Entity.${link.getter}().${fieldMappingForLink.value.getter}());
		}
#end
#end

		return ${fn.uncapitalize(${entity.name})};
	}
	
	public void map${entity.name}To${entity.name}Entity(${entity.name} ${fn.uncapitalize(${entity.name})}, ${entity.name}Entity ${fn.uncapitalize(${entity.name})}Entity) {
		if(${fn.uncapitalize(${entity.name})} == null) {
			return;
		}
		map(${fn.uncapitalize(${entity.name})}, ${fn.uncapitalize(${entity.name})}Entity);
#foreach( $link in $entity.selectedLinks )
#set( $fieldsMappingForLink = $tools.fieldsMappingForLink( $entity, $model.getEntityByClassName($link.targetEntitySimpleType), $link, $fieldsLink ) )
#foreach( $fieldMappingForLink in $fieldsMappingForLink.entrySet() )

		if(${fn.uncapitalize(${entity.name})}.${fieldMappingForLink.key.getter}() == null) {
			${fn.uncapitalize(${entity.name})}Entity.${link.setter}(null);
		} else {
			${fn.uncapitalize(${entity.name})}Entity.${link.setter}(new ${link.targetEntitySimpleType}Entity());
			${fn.uncapitalize(${entity.name})}Entity.${link.getter}().${fieldMappingForLink.value.setter}(${fn.uncapitalize(${entity.name})}.${fieldMappingForLink.key.getter}());
		}
#end
#end
	}
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	protected ModelMapper getModelMapper() {
		return modelMapper;
	}

}
